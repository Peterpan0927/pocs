# the compiler to use
CC = clang

# compiler flags:
#  -g    adds debugging information to the executable file
#  -Wall turns on most, but not all, compiler warnings
CFLAGS  = -Wall -Os -pipe -g3 -Wl,-dead_strip -Wl,-no_compact_unwind
#-g -Wall

#files to link:
LFLAGS = -lfrida-gum -lresolv -lSystem

#dirs to include
INC = -Iks/ -I.

# the name to use for both the target source file, and the output file:
TARGET = xpc_poc

OBJ_DIR = obj
BIN_DIR = bin

DIRS = $(BIN_DIR) $(OBJ_DIR)

$(shell mkdir -p $(DIRS))

all: xpc_distnoted_poc notifications_test

xpc_distnoted_poc: xpc_distnoted_poc.o 
	$(CC) -dynamiclib $(CFLAGS) $(INC) -o $(BIN_DIR)/xpc_distnoted_poc.dylib $(OBJ_DIR)/xpc_distnoted_poc.o -L. $(LFLAGS)

xpc_distnoted_poc.o: xpc_distnoted_poc.c
	$(CC) $(CFLAGS) $(INC) -c xpc_distnoted_poc.c -o $(OBJ_DIR)/xpc_distnoted_poc.o

notifications_test:
	$(CC) NotificationsTest.m -framework Foundation -o $(BIN_DIR)/NotificationsTest
